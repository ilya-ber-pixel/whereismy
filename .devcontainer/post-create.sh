#!/bin/bash
# Выходим немедленно, если любая команда завершилась с ошибкой
set -e

# --- Переменные ---
# Используем VIRTUAL_ENV - стандартную переменную для venv
export VIRTUAL_ENV="/workspace/venv"
# Добавляем venv/bin в PATH для этого скрипта
export PATH="${VIRTUAL_ENV}/bin:$PATH"

# --- Логика скрипта ---
echo "--- Запуск post-create.sh ---"

# 1. Создание или очистка виртуального окружения
echo "Шаг 1/3: Создание/очистка venv в ${VIRTUAL_ENV}..."
# Используем встроенный модуль venv, чтобы исключить uv из этого шага
python3 -m venv "${VIRTUAL_ENV}" --clear

# 2. Установка зависимостей с помощью uv
echo "Шаг 2/3: Установка зависимостей из pyproject.toml..."
# Устанавливаем пакеты в уже созданное и активированное (через PATH) окружение
pip install uv
uv pip install -e '.[dev]'

# 3. Финальная проверка
echo "Шаг 3/3: Проверка установленных пакетов..."
pip list

echo "--- Скрипт post-create.sh успешно завершен ---"
